Sun: 11/20/2016

Made ~/projects/iccr

Created github repo:  https://github.com/strongwares/iccr

git clone https://github.com/strongwares/iccr.git
~/projects/iccr/iccr$ ls
README.md

git config --global user.email "strongwares@gmail.com"
git config --global user.name "strongwares"
todo: git commit -m "First commit, working add, spend, move textotals operations."
todo: git remote add origin https://github.com/strongwares/textant.git
todo: ~/shared/textant$ git push -u origin master

sudo apt-get install maven
which mvn
/usr/bin/mvn
dana@optiPlex-780-1-ubuntu:~/projects/iccr/iccr$ mvn --version
Apache Maven 3.0.5
Maven home: /usr/share/maven
Java version: 1.7.0_75, vendor: Oracle Corporation
Java home: /usr/lib/jvm/java-7-openjdk-amd64/jre
Default locale: en_US, platform encoding: UTF-8
OS name: "linux", version: "3.16.0-34-generic", arch: "amd64", family: "unix"


Started upgrade to 16.04

Defined rest service api: /rs/app/config/{id}

Checked in first firefly-swarm packaging of uberjar with 
---------------------
Mon 11/21/16

Added global gitignore:
      ~/.gitignore_global
      git config --global core.excludesfile ~/.gitignore_global

Added check for api-access-key

Add properties source to rest impl

Add installer/iccr-scripts

Added bash script to start iccr, setting env var, setting cmd line

java env setting for prop file dir: iccrConfDir=/opt/iccr/conf

define props:
for passing to cmd line:
iccrDir=/opt/iccr
iccrConfDir=/opt/iccr/conf
iccrLogDir=/opt/iccr/logs
iccrLibDir=/opt/iccr/lib
iccrBinDir=/opt/iccr/bin
iccrLogLevel=DEBUG

for iccr.prop:
iccrStartAtStartup=false
iccrStartIotaAtStartup=false
iccrStopIotaAtShutdown=false

iccrPortNumber=14266
iotaDownloadLink=http://85.93.93.110
iotaDownloadFilename=IRI.jar
iotaDir=/opt/iota
iotaStartCmd=java -jar IRI.jar
iotaPortNumber=14265
iotaNeighbors=al,bill,fred
iotaNeighbor.key.al=al
iotaNeighbor.ip.al=10.0.0.1
iotaNeighbor.name.al=Al
iotaNeighbor.descr.al=al's node
iotaNeighbor.active.al=true
iotaNeighborRefreshTime=10

Deliver neighbors as neighbors dto

Finish /app/config update operations

checked in
-----------
Tue: 11/22/2016

Staging dist:
cp installer/property-files/src/main/resources/iccr.properties /opt/iccr/conf
cp installer/iccr-scripts/src/main/scripts/iccr-ctl /opt/iccr/bin/
cp packager/swarm/target/iccr-swarm.jar /opt/iccr/lib/iccr.jar


Finish properties: update writes out prop file

Checked in

Changed iota-api to iota-agent module

Delete iccr-agent

Delete iota-api

Checked in

Added iotaDownloadLink prop

Created ActionFactory:
install
start
stop
deletedb
delete

Checked in

------------
Wed: 11/23/2016

Add us for configurable IOTA dld link: us 26 iotaDownloadLink

Add us for configurable IOTA dld link: us 27 iotaDownloadFilename

Added prop iotaDownloadFile=IRI.jar

AbstractAction validate preconditions

us 4 iccr install iota
rest api: post rs/iota/cmd/{install}

new us 28 Iota Status Action
StatusAction
validate props iotaDir
execution: file exists, is running, answers query

checked in

-----------
Th 11/24/16

Locale values supported by jvm: http://www.oracle.com/technetwork/java/javase/java8locales-2095355.html

i18n tutorial: http://docs.oracle.com/javase/tutorial/i18n/index.html

Locale properties
# Possible values for languages (i.e. English, French, German, Spanish, Italian) are: en, fr, de, sp, it
# See http://www.oracle.com/technetwork/java/javase/java8locales-2095355.html
#iccrLanguageLocale=de
iccrLanguageLocale=en
# Possible values for English speaking countries (i.e. US, GreatBritain) are: US, GB, etc
# Possible values for German speaking countries (i.e. Germany, Austria, Switzerland) are: DE, AT, CH
# See http://www.oracle.com/technetwork/java/javase/java8locales-2095355.html
#iccrCountryLocale=DE
iccrCountryLocale=US

Localizer

MessagesBundle_de_DE.properties
MessagesBundle_en_US.properties

Action execute framework

ActionProcessFactory

OsProcessAction
ProcessBuilder: args, env, file
 ProcessBuilder for status check: ps fax | grep IRI


curl -H "Content-Type: application/json" -X POST http://localhost:14266/iccr/rs/iota/cmd/status
2016-11-24 17:24:47,457 INFO  [stdout] (default task-3) starting to execute process command (iotastatus):  ps fax | grep IRI | grep -v grep
2016-11-24 17:24:47,700 INFO  [stdout] (default task-3) exception trying to execute an action (name: iotastatus, cmd:  ps fax | grep IRI | grep -v grep): Cannot run program "ps fax | grep IRI | grep -v grep": error=2, No such file or directory
2016-11-24 17:24:47,702 INFO  [stdout] (default task-3) exception trying to execute an action (name: iotastatus, cmd:  ps fax | grep IRI | grep -v grep): Cannot run program "ps fax | grep IRI | grep -v grep": error=2, No such file or directory


todo:
iotastatus only do if linux

ProcessBuilder for iccr ctl
ProcessBuilder for iota ctl

log exceptions that are caught by rest resource

copy updated props to conf
copy msg bundles to conf

HttpAction

Http client framework: resteasy?

iccr-cli using http client to talk to iccr over iccr rest api

StatusAction execution

Shutdown hook

Server emit localized text

new us: audit log

new us: localized text
iccrCountryLocale=US
iccrLanguageLocale=en
#iccrCountryLocale=DE
#iccrLanguageLocale=de


How best to do neighbors in java prop file: each nbr needs a key?

Do specific app/config/neighbors get/set rest api?

InstallAction:
validate props iotaDir, iotaDownloadLink, iotaDownloadFilename
get Iota status
stop Iota if necessary
make backup copy of iota
download
remember version and date

update us 4 additional prop validations

us 5 iccr remember iota install info

us 6 iccr iota get install info
rest api: get rs/iota/installinfo
agent

us 7 iccr start iota
rest api: post /rs/iota/cmd/{start}
StartAction:
validate props iotaDir, iotaStartCmd, iotaPortNumber

us 8 iccr stop iota
rest api:  post /rs/iota/cmd/{stop}
StopAction:
validate props iotaDir


us 9 iccr delete iota db
rest api: post /rs/iota/cmd/{deletedb}
DeletedbAction:
validate props iotaDir

us 10 iccr delete iota
rest api: post /rs/iota/cmd/{delete}
DeleteAction:
validate props iotaDir

us 11 get iota node info
rest api: get /rs/iota/nodeinfo
agent

us 12 get iota nbrs
rest api: get /rs/iota/neighbors
agent

Manage logs: silence swarm, store changes to single file for audit purposes

Will update of neighbor config prop need a specific dto for incoming handling?

us 5 remember iota install info

us 6 rest api for get iota isntall info

test resources:
iccr.properties

installer:
iccr.properties

finish installer/iccr-scripts

finish installer/property-files

load api access key into resource impl

add logging

windows cmd script to control iccr

autodetect if iota is already installed and/or running at install
